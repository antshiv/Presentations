<svg id="b162ab73-9a35-40d9-8ff5-855c23790d64" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 835.4"><rect x="50" y="18.04" width="700" height="350" rx="10" style="fill:#e8f5e9;stroke:#4caf50;stroke-width:2px"/><text transform="translate(162.42 58.04)" style="isolation:isolate;font-size:24px;fill:#4caf50;font-family:Arial-BoldMT, Arial;font-weight:700"><tspan style="letter-spacing:-0.07421875em">A</tspan><tspan x="15.55" y="0">VX-512 OPTIMIZ</tspan><tspan x="199.59" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="215.14" y="0">TION OPPORTUNITIES</tspan></text><text transform="translate(70 98.04)" style="isolation:isolate;font-size:18px;fill:#2e7d32;font-family:Arial-BoldMT, Arial;font-weight:700">1. Q @ K^T Computation:</text><path d="M75,108H725c2.76,0,5,2.75,5,6.14v86c0,3.39-2.24,6.14-5,6.14H75c-2.76,0-5-2.75-5-6.14v-86C70,110.79,72.24,108,75,108Z" style="fill:#f1f8e9;stroke:#689f38"/><text transform="translate(80 128.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">// Process 16 elements at once with AVX-512</text><text transform="translate(80 148.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">__m512 q_vec = _mm512_load_ps(&amp;Q[i*head_dim + d]);</text><text transform="translate(80 168.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">__m512 k_vec = _mm512_load_ps(&amp;K[j*head_dim + d]);</text><text transform="translate(80 188.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">acc = _mm512_fmadd_ps(q_vec, k_vec, acc); // 32 FLOPS!</text><text transform="translate(70 228.04)" style="isolation:isolate;font-size:18px;fill:#2e7d32;font-family:Arial-BoldMT, Arial;font-weight:700">2. <tspan x="20.01" y="0" style="letter-spacing:-0.05517578125em">V</tspan><tspan x="31.03" y="0">ectorized Softmax:</tspan></text><path d="M75,238H725c2.76,0,5,2.72,5,6.07v60.65c0,3.35-2.24,6.07-5,6.07H75c-2.76,0-5-2.72-5-6.07V244.11C70,240.76,72.24,238,75,238Z" style="fill:#f1f8e9;stroke:#689f38"/><text transform="translate(80 258.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">// Find max across 16 values simultaneously</text><text transform="translate(80 278.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">__m512 max_vec = _mm512_max_ps(scores_vec, max_vec);</text><text transform="translate(80 298.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">// Vectorized exp: huge speedup over scalar</text><text transform="translate(70 338.04)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">Expected speedup: 8-16x over scalar code!</text><rect x="850" y="18.04" width="700" height="350" rx="10" style="fill:#e3f2fd;stroke:#2196f3;stroke-width:2px"/><text transform="translate(955.31 58.04)" style="isolation:isolate;font-size:24px;fill:#2196f3;font-family:Arial-BoldMT, Arial;font-weight:700">HEAD-MAJOR VS <tspan x="208.02" y="0" style="letter-spacing:-0.01806640625em">T</tspan><tspan x="222.25" y="0">OKEN-MAJOR L</tspan><tspan x="407.58" y="0" style="letter-spacing:-0.091796875em">A</tspan><tspan x="422.71" y="0">YOUT</tspan></text><text transform="translate(870 98.04)" style="isolation:isolate;font-size:18px;fill:#1976d2;font-family:Arial-BoldMT, Arial;font-weight:700"><tspan style="letter-spacing:-0.07421875em">T</tspan><tspan x="9.66" y="0">oken-Major (</tspan><tspan x="116.67" y="0" style="letter-spacing:-0.05517578125em">T</tspan><tspan x="126.67" y="0">raditional):</tspan></text><rect x="870" y="108.04" width="300" height="40" style="fill:#bbdefb;stroke:#1976d2"/><text transform="translate(880 133.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">[Token0: H0|H1|H2|...|H7]</text><text transform="translate(880 168.04)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">Problem: Heads scattered in memory</text><text transform="translate(880 186.04)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">Cache misses when computing attention</text><text transform="translate(1220 98.04)" style="isolation:isolate;font-size:18px;fill:#1976d2;font-family:Arial-BoldMT, Arial;font-weight:700">Head-Major (Optimized):</text><rect x="1220" y="108.04" width="300" height="40" style="fill:#90caf9;stroke:#1976d2"/><text transform="translate(1230 133.04)" style="isolation:isolate;font-size:14px;font-family:CourierNewPSMT, Courier New">[Head0: T0|T1|T2|...|T7]</text><text transform="translate(1230 168.04)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">Benefit:<tspan x="47.48" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="50.59" y="0">All tokens for a head are contiguous</tspan></text><text transform="translate(1230 186.04)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">Perfect cache utilization!</text><rect x="870" y="218.04" width="660" height="120" rx="5" style="fill:#e1f5fe;stroke:#0288d1"/><text transform="translate(880 243.04)" style="isolation:isolate;font-size:16px;font-family:Arial-BoldMT, Arial;font-weight:700">Performance Impact:</text><text transform="translate(880 268.04)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">• QK^<tspan x="35.59" y="0" style="letter-spacing:-0.01806640625em">T</tspan><tspan x="43.89" y="0" xml:space="preserve"> computation: 2-3x faster (sequential access)</tspan></text><text transform="translate(880 288.04)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">• Softmax: 1.5x faster (row-wise operations)</text><text transform="translate(880 308.04)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">• Overall attention: 2-5x speedup</text><text transform="translate(880 328.04)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">•<tspan x="4.9" y="0" style="letter-spacing:-0.01806640625em"> </tspan><tspan x="8.54" y="0" style="letter-spacing:-0.091796875em">Y</tspan><tspan x="16.59" y="0">our 72 cores can process heads in parallel!</tspan></text><rect x="50" y="418.04" width="1500" height="400" rx="10" style="fill:#f3e5f5;stroke:#7b1fa2;stroke-width:2px"/><text transform="translate(466.88 458.04)" style="isolation:isolate;font-size:28px;fill:#7b1fa2;font-family:Arial-BoldMT, Arial;font-weight:700">COMPLETE<tspan x="155.56" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="162.3" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="180.44" y="0">TTENTION IMPLEMEN</tspan><tspan x="475.99" y="0" style="letter-spacing:-0.07421875em">TA</tspan><tspan x="509.15" y="0">TION FLOW</tspan></text><path d="M155,498H345a5.29,5.29,0,0,1,5,5.53v77.37a5.29,5.29,0,0,1-5,5.53H155a5.29,5.29,0,0,1-5-5.53V503.57A5.29,5.29,0,0,1,155,498Z" style="fill:#e1bee7;stroke:#7b1fa2"/><text transform="translate(200.82 528.04)" style="isolation:isolate;font-size:16px;font-family:Arial-BoldMT, Arial;font-weight:700">Input <tspan x="43.54" y="0" style="letter-spacing:-0.07421875em">T</tspan><tspan x="52.13" y="0">okens</tspan></text><text transform="translate(188.52 548.04)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">[batch, seq, embed]</text><text transform="translate(209.97 566.04)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">e.g., [1, 8, 512]</text><path d="M380,528l20,10-20,10Z" style="fill:#7b1fa2"/><path d="M405,498H595a5.29,5.29,0,0,1,5,5.53v77.37a5.29,5.29,0,0,1-5,5.53H405a5.29,5.29,0,0,1-5-5.53V503.57A5.29,5.29,0,0,1,405,498Z" style="fill:#ce93d8;stroke:#7b1fa2"/><text transform="translate(441.32 523.04)" style="isolation:isolate;font-size:16px;font-family:Arial-BoldMT, Arial;font-weight:700">QKV Projection</text><text transform="translate(453.19 543.04)" style="isolation:isolate;font-size:12px;font-family:CourierNewPSMT, Courier New">gemm_avx512()</text><text transform="translate(459.82 560.04)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">3 × GEMM ops</text><text transform="translate(462.32 576.04)" style="isolation:isolate;font-size:12px;fill:#4caf50;font-family:ArialMT, Arial">474 GFLOPS!</text><path d="M630,528l20,10-20,10Z" style="fill:#7b1fa2"/><path d="M655,498H845a5.29,5.29,0,0,1,5,5.53v77.37a5.29,5.29,0,0,1-5,5.53H655a5.29,5.29,0,0,1-5-5.53V503.57A5.29,5.29,0,0,1,655,498Z" style="fill:#ba68c8;stroke:#7b1fa2"/><text transform="translate(680.64 523.04)" style="isolation:isolate;font-size:16px;font-family:Arial-BoldMT, Arial;font-weight:700">Reshape to Heads</text><text transform="translate(693.64 543.04)" style="isolation:isolate;font-size:12px;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.11083984375em">T</tspan><tspan x="6" y="0">oken → Head major</tspan></text><text transform="translate(719.98 560.04)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">[1, 8, 8, 64]</text><text transform="translate(709.98 576.04)" style="isolation:isolate;font-size:12px;fill:#1e701e;font-family:ArialMT, Arial">Cache optimal!</text><path d="M880,528l20,10-20,10Z" style="fill:#7b1fa2"/><path d="M905,498h190a5.29,5.29,0,0,1,5,5.53v77.37a5.29,5.29,0,0,1-5,5.53H905a5.29,5.29,0,0,1-5-5.53V503.57A5.29,5.29,0,0,1,905,498Z" style="fill:#ab47bc;stroke:#7b1fa2"/><text transform="translate(941.55 518.04)" style="isolation:isolate;font-size:16px;font-family:Arial-BoldMT, Arial;font-weight:700">Compute QK^T</text><text transform="translate(953.19 536.04)" style="isolation:isolate;font-size:12px;font-family:CourierNewPSMT, Courier New">gemm_avx512()</text><text transform="translate(954.64 552.04)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">Per head parallel</text><text transform="translate(962.35 568.04)" style="isolation:isolate;font-size:12px;fill:#4caf50;font-family:ArialMT, Arial">Scale by √d_k</text><path d="M1130,528l20,10-20,10Z" style="fill:#7b1fa2"/><path d="M1155,498h190a5.29,5.29,0,0,1,5,5.53v77.37a5.29,5.29,0,0,1-5,5.53H1155a5.29,5.29,0,0,1-5-5.53V503.57A5.29,5.29,0,0,1,1155,498Z" style="fill:#9c27b0;stroke:#7b1fa2"/><text transform="translate(1189.98 523.04)" style="isolation:isolate;font-size:16px;font-family:Arial-BoldMT, Arial;font-weight:700">Causal Softmax</text><text transform="translate(1215.09 543.04)" style="isolation:isolate;font-size:12px;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.07421875em">A</tspan><tspan x="7.11" y="0">VX-512 exp</tspan></text><text transform="translate(1208.66 560.04)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">Row-wise norm</text><text transform="translate(1218.66 576.04)" style="isolation:isolate;font-size:12px;fill:#4caf50;font-family:ArialMT, Arial">Mask future</text><path d="M405,618H595a5.27,5.27,0,0,1,5,5.5v76.92a5.27,5.27,0,0,1-5,5.5H405a5.27,5.27,0,0,1-5-5.5V623.54A5.27,5.27,0,0,1,405,618Z" style="fill:#8e24aa;stroke:#7b1fa2"/><text transform="translate(450.45 643.04)" style="isolation:isolate;font-size:16px;font-family:Arial-BoldMT, Arial;font-weight:700">Attention × V</text><text transform="translate(453.19 663.04)" style="isolation:isolate;font-size:12px;font-family:CourierNewPSMT, Courier New">gemm_avx512()</text><text transform="translate(461.76 680.04)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.01806640625em">W</tspan><tspan x="11.11" y="0">eighted sum</tspan></text><text transform="translate(462.98 696.04)" style="isolation:isolate;font-size:12px;fill:#4caf50;font-family:ArialMT, Arial">Reuse kernel!</text><path d="M630,648l20,10-20,10Z" style="fill:#7b1fa2"/><path d="M655,618H845a5.27,5.27,0,0,1,5,5.5v76.92a5.27,5.27,0,0,1-5,5.5H655a5.27,5.27,0,0,1-5-5.5V623.54A5.27,5.27,0,0,1,655,618Z" style="fill:#7b1fa2;stroke:#7b1fa2"/><text transform="translate(696.65 643.04)" style="isolation:isolate;font-size:16px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">Concat Heads</text><text transform="translate(693.75 663.04)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">Head →<tspan x="44.02" y="0" style="letter-spacing:-0.01806640625em"> </tspan><tspan x="47.14" y="0" style="letter-spacing:-0.11083984375em">T</tspan><tspan x="53.14" y="0">oken major</tspan></text><text transform="translate(723.31 680.04)" style="isolation:isolate;font-size:12px;fill:#e1bee7;font-family:ArialMT, Arial">[1, 8, 512]</text><text transform="translate(696.31 696.04)" style="isolation:isolate;font-size:12px;fill:#81c784;font-family:ArialMT, Arial">Ready for next layer</text><path d="M880,648l20,10-20,10Z" style="fill:#7b1fa2"/><path d="M905,618h190a5.27,5.27,0,0,1,5,5.5v76.92a5.27,5.27,0,0,1-5,5.5H905a5.27,5.27,0,0,1-5-5.5V623.54A5.27,5.27,0,0,1,905,618Z" style="fill:#6a1b9a;stroke:#7b1fa2"/><text transform="translate(932.45 643.04)" style="isolation:isolate;font-size:16px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">Output Projection</text><text transform="translate(953.19 663.04)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:CourierNewPSMT, Courier New">gemm_avx512()</text><text transform="translate(959.99 680.04)" style="isolation:isolate;font-size:12px;fill:#e1bee7;font-family:ArialMT, Arial">Final transform</text><text transform="translate(959.32 696.04)" style="isolation:isolate;font-size:12px;fill:#81c784;font-family:ArialMT, Arial">Context-aware!</text><path d="M510,598l-10,20-10-20Z" style="fill:#7b1fa2"/><rect x="150" y="738.04" width="1300" height="60" rx="5" style="fill:#f3e5f5;stroke:#7b1fa2"/><text transform="translate(504.86 763.04)" style="isolation:isolate;font-size:18px;fill:#7b1fa2;font-family:Arial-BoldMT, Arial;font-weight:700"><tspan style="letter-spacing:-0.07421875em">T</tspan><tspan x="9.66" y="0">otal Operations: 4 GEMMs + 1 Softmax = ~90% of attention compute</tspan></text><text transform="translate(554.14 786.04)" style="isolation:isolate;font-size:16px;fill:#666;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.091796875em">Y</tspan><tspan x="9.2" y="0">our optimized GEMM kernel is reused 4 times - maximum e</tspan><tspan x="429.77" y="0" style="letter-spacing:-0.01806640625em">f</tspan><tspan x="433.93" y="0">ficiency!</tspan></text></svg>