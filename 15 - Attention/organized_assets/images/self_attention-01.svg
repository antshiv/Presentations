<svg id="e8afd89a-c2d5-4cef-b6e5-1c241b529fa9" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 761.53"><text transform="translate(393.77 40)" style="isolation:isolate;font-size:32px;fill:#e8e8e8;font-family:Arial-BoldMT, Arial;font-weight:700">Casual-Attention: From Math to<tspan x="478.19" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="485.89" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="506.63" y="0">VX-512 Implementation</tspan></text><text transform="translate(526.95 70)" style="isolation:isolate;font-size:18px;fill:#e8e8e8;font-family:ArialMT, Arial">How tokens learn to &quot;attend&quot; to each other through matrix operations</text><rect x="50" y="100" width="700" height="200" rx="10" style="fill:#f0f4f8;stroke:#4a90e2;stroke-width:2px"/><text transform="translate(294.23 130)" style="isolation:isolate;font-size:24px;fill:#4a90e2;font-family:Arial-BoldMT, Arial;font-weight:700">WH<tspan x="39.98" y="0" style="letter-spacing:-0.01806640625em">Y</tspan><tspan x="55.56" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="61.34" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="76.89" y="0">TTENTION?</tspan></text><text transform="translate(70 160)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">Problem: &quot;The cat sat on the mat because it was soft&quot;</text><text transform="translate(70 185)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">What does &quot;it&quot; refer to?<tspan x="164.32" y="0" style="letter-spacing:-0.01806640625em"> </tspan><tspan x="168.48" y="0">The cat or the mat?</tspan></text><rect x="70" y="210" width="60" height="30" rx="5" style="fill:#ffeb3b;stroke:#333"/><text transform="translate(87.94 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">The</text><rect x="140" y="210" width="60" height="30" rx="5" style="fill:#ffeb3b;stroke:#333"/><text transform="translate(160.66 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">cat</text><rect x="210" y="210" width="60" height="30" rx="5" style="fill:#ffeb3b;stroke:#333"/><text transform="translate(230.66 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">sat</text><rect x="280" y="210" width="60" height="30" rx="5" style="fill:#ffeb3b;stroke:#333"/><text transform="translate(302.21 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">on</text><rect x="350" y="210" width="60" height="30" rx="5" style="fill:#ffeb3b;stroke:#333"/><text transform="translate(370.27 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">the</text><rect x="420" y="210" width="60" height="30" rx="5" style="fill:#ff9800;stroke:#333"/><text transform="translate(438.33 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">mat</text><rect x="490" y="210" width="60" height="30" rx="5" style="fill:#ffeb3b;stroke:#333"/><text transform="translate(514.17 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">...</text><rect x="560" y="210" width="60" height="30" rx="5" style="fill:#4caf50;stroke:#333"/><text transform="translate(586.5 230)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">it</text><path d="M450,270l-20-10,20-10Z" style="fill:#4caf50"/><text transform="translate(510 275)" style="isolation:isolate;font-size:12px;fill:#4caf50;font-family:ArialMT, Arial">attention</text><rect x="850" y="100" width="700" height="200" rx="10" style="fill:#f8f0ff;stroke:#9c27b0;stroke-width:2px"/><text transform="translate(1070.65 130)" style="isolation:isolate;font-size:24px;fill:#9c27b0;font-family:Arial-BoldMT, Arial;font-weight:700">TENSOR DIMENSIONS</text><text transform="translate(870 160)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">Input: [batch_size, seq_len, embed_dim]</text><text transform="translate(870 185)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">Example: [1, 8, 512] → 8 tokens, 512-dimensional</text><rect x="870" y="210" width="80" height="60" style="fill:#e1bee7;stroke:#9c27b0"/><text transform="translate(885.48 245)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.11083984375em">T</tspan><tspan x="7" y="0">oken 0</tspan></text><text transform="translate(896.66 260)" style="isolation:isolate;font-size:12px;font-family:ArialMT, Arial">[512]</text><rect x="960" y="210" width="80" height="60" style="fill:#e1bee7;stroke:#9c27b0"/><text transform="translate(975.48 245)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.11083984375em">T</tspan><tspan x="7" y="0">oken 1</tspan></text><text transform="translate(986.66 260)" style="isolation:isolate;font-size:12px;font-family:ArialMT, Arial">[512]</text><text transform="translate(1050 240)" style="isolation:isolate;font-size:20px;font-family:ArialMT, Arial">...</text><rect x="1090" y="210" width="80" height="60" style="fill:#e1bee7;stroke:#9c27b0"/><text transform="translate(1105.48 245)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.11083984375em">T</tspan><tspan x="7" y="0">oken 7</tspan></text><text transform="translate(1116.66 260)" style="isolation:isolate;font-size:12px;font-family:ArialMT, Arial">[512]</text><text transform="translate(1200 240)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">After QKV projection:</text><text transform="translate(1200 265)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">Q, K, <tspan x="40.9" y="0" style="letter-spacing:-0.037109375em">V</tspan><tspan x="50.98" y="0">: [batch, heads, seq_len, head_dim]</tspan></text><text transform="translate(1200 290)" style="isolation:isolate;font-size:16px;fill:#333;font-family:ArialMT, Arial">Example: [1, 8, 8, 64] → 8 heads, 64 dims/head</text><rect x="50" y="350" width="1500" height="400" rx="10" style="fill:#fff8e1;stroke:#ff6f00;stroke-width:2px"/><text transform="translate(560.99 390)" style="isolation:isolate;font-size:28px;fill:#ff6f00;font-family:Arial-BoldMT, Arial;font-weight:700">THE M<tspan x="87.1" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="105.25" y="0">THEM</tspan><tspan x="184.57" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="202.71" y="0">TICS OF</tspan><tspan x="313.15" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="319.89" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="338.04" y="0">TTENTION</tspan></text><rect x="100" y="430" width="300" height="250" rx="5" style="fill:#fff3e0;stroke:#ff6f00"/><text transform="translate(140.54 455)" style="isolation:isolate;font-size:20px;fill:#ff6f00;font-family:Arial-BoldMT, Arial;font-weight:700">Step 1: QKV Projection</text><text transform="translate(110 485)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">X → Linear transformations:</text><text transform="translate(110 510)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">Q = XW_q [8×512]×[512×512]</text><text transform="translate(110 535)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">K = XW_k [8×512]×[512×512]</text><text transform="translate(110 560)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">V = XW_v [8×512]×[512×512]</text><text transform="translate(110 595)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.091796875em">Y</tspan><tspan x="8.05" y="0">our GEMM kernel shines here!</tspan></text><rect x="110" y="605" width="280" height="40" rx="5" style="fill:#e8f5e9;stroke:#4caf50"/><text transform="translate(115 625)" style="isolation:isolate;font-size:14px;fill:#2e7d32;font-family:CourierNewPSMT, Courier New">gemm_avx512_parallel(X, W_q, Q)</text><text transform="translate(115 640)" style="isolation:isolate;font-size:12px;fill:#2e7d32;font-family:ArialMT, Arial">→ 474 GFLOPS on your setup!</text><rect x="450" y="430" width="300" height="250" rx="5" style="fill:#fff3e0;stroke:#ff6f00"/><text transform="translate(484.24 455)" style="isolation:isolate;font-size:20px;fill:#ff6f00;font-family:Arial-BoldMT, Arial;font-weight:700">Step 2:<tspan x="66.68" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="71.49" y="0">Attention Scores</tspan></text><text transform="translate(460 485)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">Scores = Q @ K^T / √d_k</text><text transform="translate(460 510)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">[8×8×64] @ [8×64×8]</text><text transform="translate(460 535)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">→ [8×8×8] per head</text><rect x="500" y="560" width="60" height="60" style="fill:#ffccbc;stroke:#ff6f00"/><text transform="translate(524.56 595)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">Q</text><text transform="translate(570 595)" style="isolation:isolate;font-size:20px;font-family:ArialMT, Arial">×</text><rect x="590" y="560" width="60" height="60" style="fill:#ffccbc;stroke:#ff6f00"/><text transform="translate(607.77 595)" style="isolation:isolate;font-size:14px;font-family:ArialMT, Arial">K^<tspan x="15.91" y="0" style="letter-spacing:-0.01806640625em">T</tspan></text><text transform="translate(660 595)" style="isolation:isolate;font-size:20px;font-family:ArialMT, Arial">=</text><rect x="680" y="560" width="60" height="60" style="fill:#ff8a65;stroke:#ff6f00"/><text transform="translate(691.33 595)" style="isolation:isolate;font-size:12px;font-family:ArialMT, Arial">Scores</text><text transform="translate(460 640)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">Each score[i,j] = &quot;How much</text><text transform="translate(460 658)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">should token i attend to token j?&quot;</text><rect x="800" y="430" width="300" height="250" rx="5" style="fill:#fff3e0;stroke:#ff6f00"/><text transform="translate(832.2 455)" style="isolation:isolate;font-size:20px;fill:#ff6f00;font-family:Arial-BoldMT, Arial;font-weight:700">Step 3: Softmax (Causal)</text><text transform="translate(810 485)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">For each row i:</text><text transform="translate(810 510)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">1. Mask future: S[i,j&gt;i] = -∞</text><text transform="translate(810 535)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">2. exp(S[i,:] - max(S[i,:]))</text><text transform="translate(810 560)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">3. Normalize: sum to 1.0</text><text transform="translate(850 575)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">Causal mask pattern:</text><rect x="850" y="580" width="15" height="15" style="fill:#4caf50"/><rect x="850" y="596" width="15" height="15" style="fill:#4caf50"/><rect x="866" y="596" width="15" height="15" style="fill:#4caf50"/><rect x="850" y="612" width="15" height="15" style="fill:#4caf50"/><rect x="866" y="612" width="15" height="15" style="fill:#4caf50"/><rect x="882" y="612" width="15" height="15" style="fill:#4caf50"/><rect x="850" y="628" width="15" height="15" style="fill:#4caf50"/><rect x="866" y="628" width="15" height="15" style="fill:#4caf50"/><rect x="882" y="628" width="15" height="15" style="fill:#4caf50"/><rect x="898" y="628" width="15" height="15" style="fill:#4caf50"/><rect x="866" y="580" width="15" height="15" style="fill:#f44336;isolation:isolate;opacity:0.30000001192092896"/><rect x="882" y="580" width="15" height="15" style="fill:#f44336;isolation:isolate;opacity:0.30000001192092896"/><rect x="898" y="580" width="15" height="15" style="fill:#f44336;isolation:isolate;opacity:0.30000001192092896"/><rect x="882" y="596" width="15" height="15" style="fill:#f44336;isolation:isolate;opacity:0.30000001192092896"/><rect x="898" y="596" width="15" height="15" style="fill:#f44336;isolation:isolate;opacity:0.30000001192092896"/><rect x="898" y="612" width="15" height="15" style="fill:#f44336;isolation:isolate;opacity:0.30000001192092896"/><text transform="translate(930 610)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">Green:<tspan x="36.69" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="39.36" y="0">Allowed</tspan></text><text transform="translate(930 625)" style="isolation:isolate;font-size:12px;fill:#666;font-family:ArialMT, Arial">Red: Masked</text><rect x="1150" y="430" width="300" height="250" rx="5" style="fill:#fff3e0;stroke:#ff6f00"/><text transform="translate(1194.62 455)" style="isolation:isolate;font-size:20px;fill:#ff6f00;font-family:Arial-BoldMT, Arial;font-weight:700">Step 4: <tspan x="72.24" y="0" style="letter-spacing:-0.01806640625em">W</tspan><tspan x="90.75" y="0">eighted Sum</tspan></text><text transform="translate(1160 485)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">Output = Softmax(Scores) @ V</text><text transform="translate(1160 510)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">[8×8×8] @ [8×8×64]</text><text transform="translate(1160 535)" style="isolation:isolate;font-size:16px;font-family:CourierNewPSMT, Courier New">→ [8×8×64] per head</text><text transform="translate(1160 570)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">Each output token is now a</text><text transform="translate(1160 588)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">weighted combination of all</text><text transform="translate(1160 606)" style="isolation:isolate;font-size:14px;fill:#666;font-family:ArialMT, Arial">previous tokens&apos; values!</text><rect x="1160" y="620" width="280" height="40" rx="5" style="fill:#e8f5e9;stroke:#4caf50"/><text transform="translate(1165 640)" style="isolation:isolate;font-size:14px;fill:#2e7d32;font-family:CourierNewPSMT, Courier New">gemm_avx512(Attn, V, Output)</text><text transform="translate(1165 655)" style="isolation:isolate;font-size:12px;fill:#2e7d32;font-family:ArialMT, Arial">Reuse your optimized kernel!</text></svg>