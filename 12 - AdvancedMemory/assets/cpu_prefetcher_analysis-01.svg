<svg id="fa49e661-3640-477f-94f1-7ae7363f2c8d" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 512.4"><text transform="translate(322.09 30)" style="isolation:isolate;font-size:24px;fill:#edf0f2;font-family:Arial-BoldMT, Arial;font-weight:700">CPU Prefetcher: Pattern Recognition Engine</text><text transform="translate(365.83 55)" style="isolation:isolate;font-size:16px;fill:#7f8c8d;font-family:ArialMT, Arial">How Memory<tspan x="94.23" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="97.8" y="0">Access Patterns Make or Break Performance</tspan></text><rect x="50" y="80" width="500" height="40" style="fill:#d5f4e6;stroke:#27ae60;stroke-width:2px"/><rect x="60" y="140" width="480" height="60" style="fill:#f8fffe;stroke:#bdc3c7"/><text transform="translate(70 160)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 1: Initial Read</text><text transform="translate(70 180)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">CPU core needs data at address 1000 (first LayerNorm weight)</text><text transform="translate(70 195)" style="isolation:isolate;font-size:12px;fill:#e67e22;font-family:MyriadPro-Regular, Myriad Pro">⏱️<tspan x="6" y="0" xml:space="preserve" style="font-family:ArialMT, Arial"> Slow read from DRAM (~300 cycles)</tspan></text><rect x="365" y="149" width="40" height="20" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(373.88 162)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">1000</text><polygon points="345 152 365 159 345 166 345 152" style="fill:#3498db"/><text transform="translate(278.85 162.12)" style="isolation:isolate;font-size:10px;fill:#3498db;font-family:ArialMT, Arial">CPU Request</text><rect x="60" y="210" width="480" height="60" style="fill:#f8fffe;stroke:#bdc3c7"/><text transform="translate(70 230)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 2: Pattern Detection</text><text transform="translate(70 250)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">Next request at address 1064 (next cache line). Prefetcher detects stride-1 pattern!</text><rect x="350" y="220" width="40" height="20" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(358.88 233)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">1000</text><rect x="414" y="220" width="40" height="20" style="fill:#27ae60;stroke:#229954"/><text transform="translate(422.88 233)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">1064</text><polygon points="392 223 412 230 392 237 392 223" style="fill:#27ae60"/><text transform="translate(70.49 265.05)" style="isolation:isolate;font-size:12px;fill:#27ae60;font-family:ArialMT, Arial">🧠 Prefetcher: &quot;Aha! Sequential access detected</text><rect x="60" y="280" width="480" height="70" style="fill:#f8fffe;stroke:#bdc3c7"/><text transform="translate(70 300)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 3: Speculative Prefetching</text><text transform="translate(70 320)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">Prefetcher runs ahead, loading addresses <tspan x="226.14" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="231.93" y="0">128, </tspan><tspan x="258.62" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="264.4" y="0">192, 1256... into cache</tspan></text><rect x="396.88" y="290" width="30" height="15" style="fill:#27ae60;stroke:#229954"/><text transform="translate(403.28 300)" style="isolation:isolate;font-size:8px;fill:#fff;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.07421875em">1</tspan><tspan x="3.86" y="0">128</tspan></text><rect x="438" y="290" width="30" height="15" style="fill:#27ae60;stroke:#229954"/><text transform="translate(444.4 300)" style="isolation:isolate;font-size:8px;fill:#fff;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.07421875em">1</tspan><tspan x="3.86" y="0">192</tspan></text><rect x="480" y="290" width="30" height="15" style="fill:#27ae60;stroke:#229954"/><text transform="translate(486.1 300)" style="isolation:isolate;font-size:8px;fill:#fff;font-family:ArialMT, Arial">1256</text><text transform="translate(515 300)" style="isolation:isolate;font-size:8px;fill:#27ae60;font-family:ArialMT, Arial">...</text><polygon points="385.88 293.5 395.88 297 385.88 300.5 385.88 293.5" style="fill:#27ae60"/><polygon points="428 293.5 438 297 428 300.5 428 293.5" style="fill:#27ae60"/><polygon points="469 293.5 479 297 469 300.5 469 293.5" style="fill:#27ae60"/><text transform="translate(70.49 341.68)" style="isolation:isolate;font-size:12px;fill:#27ae60;font-family:ArialMT, Arial">🚀 Prefetcher confidence: 95%+</text><rect x="60" y="360" width="480" height="60" style="fill:#f8fffe;stroke:#bdc3c7"/><text transform="translate(70 380)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 4: The Hit</text><text transform="translate(70 400)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">CPU asks for address <tspan x="120.04" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="125.82" y="0">128 - it&apos;s already in L2 cache!</tspan></text><text transform="translate(70 415)" style="isolation:isolate;font-size:12px;fill:#27ae60;font-family:ArialMT, Arial">⚡ Cache hit: ~10 cycles instead of ~300</text><rect x="400" y="370.26" width="52.57" height="20" style="fill:#f39c12;stroke:#e67e22"/><text transform="translate(403.51 383)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">L2 Cache</text><line x1="331.81" y1="380.26" x2="384.66" y2="380.26" style="fill:#f39c12;stroke:#e67e22"/><polygon points="380 373 400 380 380 387 380 373" style="fill:#3498db"/><text transform="translate(280 375)" style="isolation:isolate;font-size:10px;fill:#f39c12;font-family:ArialMT, Arial">Fast Hit!</text><rect x="60" y="430" width="480" height="60" style="fill:#d5f4e6;stroke:#27ae60;stroke-width:2px"/><text transform="translate(70 450)" style="isolation:isolate;font-size:14px;fill:#27ae60;font-family:Arial-BoldMT, Arial;font-weight:700">Step 5: Full Pipeline Efficiency</text><text transform="translate(70 470)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">Prefetcher stays ahead, cache always full, CPU never waits</text><text transform="translate(70 484.83)" style="isolation:isolate;font-size:12px;fill:#27ae60;font-family:ArialMT, Arial">🎯 Result: Maximum throughput, ~95% compute utilization</text><text transform="translate(70 105.3)" style="isolation:isolate;font-size:17px;fill:#27ae60;font-family:ArialMT, Arial">🟢<tspan x="12.75" y="0" xml:space="preserve" style="font-family:Arial-BoldMT, Arial;font-weight:700"> THE GOOD </tspan><tspan x="112.87" y="0" style="font-family:Arial-BoldMT, Arial;font-weight:700;letter-spacing:-0.07421875em">PA</tspan><tspan x="133.96" y="0" style="font-family:Arial-BoldMT, Arial;font-weight:700">TH: Sequential Layout</tspan></text><rect x="600" y="80" width="550" height="40" style="fill:#ffebee;stroke:#e74c3c;stroke-width:2px"/><text transform="translate(620 105.3)" style="isolation:isolate;font-size:14px;fill:#e74c3c;font-family:ArialMT, Arial">🔴<tspan x="10.5" y="0" xml:space="preserve" style="font-family:Arial-BoldMT, Arial;font-weight:700"> THE BAD </tspan><tspan x="80.5" y="0" style="font-family:Arial-BoldMT, Arial;font-weight:700;letter-spacing:-0.07421875em">PA</tspan><tspan x="97.87" y="0" style="font-family:Arial-BoldMT, Arial;font-weight:700">TH: Interleaved Layout (Karpathy&apos;s Current)</tspan></text><rect x="610" y="140" width="530" height="60" style="fill:#fffefe;stroke:#bdc3c7"/><text transform="translate(620 160)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 1: Initial Read</text><text transform="translate(620 180)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">CPU core needs data at address 1000 (LayerNorm weight)</text><text transform="translate(620 195)" style="isolation:isolate;font-size:12px;fill:#e67e22;font-family:MyriadPro-Regular, Myriad Pro">⏱️<tspan x="6" y="0" xml:space="preserve" style="font-family:ArialMT, Arial"> Slow read from DRAM (~300 cycles)</tspan></text><rect x="950" y="150" width="40" height="20" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(958.88 163)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">1000</text><polygon points="930 153 950 160 930 167 930 153" style="fill:#3498db"/><rect x="610" y="210" width="530" height="60" style="fill:#fffefe;stroke:#bdc3c7"/><path d="M989.32,228.18c0-7.17,8.34-11.88,18.35-13,11.67-1.27,20.19.72,25.67,3.74" style="fill:none;stroke:#e74c3c;stroke-miterlimit:10"/><text transform="translate(620 230)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 2: Pattern Disruption</text><text transform="translate(620 250)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">Next data needed: activation at address 80000 (huge jump!)</text><rect x="950" y="220" width="40" height="20" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(958.88 233)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">1000</text><rect x="1050" y="220" width="50" height="20" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(1061.1 233)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">80000</text><polygon points="1037.24 213.08 1050 230 1029.48 224.73 1037.24 213.08" style="fill:#e74c3c"/><text transform="translate(1001.45 224.83)" style="isolation:isolate;font-size:8px;fill:#e74c3c;font-family:ArialMT, Arial">JUMP!</text><text transform="translate(620 265.05)" style="isolation:isolate;font-size:12px;fill:#e74c3c;font-family:ArialMT, Arial">🤔 Prefetcher: &quot;What pattern?<tspan x="154" y="0" style="letter-spacing:-0.01806640625em"> </tspan><tspan x="157.11" y="0">This looks random!&quot;</tspan></text><rect x="610" y="280" width="530" height="70" style="fill:#fffefe;stroke:#bdc3c7"/><text transform="translate(620 300)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 3: Prefetcher Confusion</text><text transform="translate(620 320)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">Prefetcher guesses 80064, but next access is back to 2500</text><rect x="1050" y="290" width="40" height="15" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(1058.88 300)" style="isolation:isolate;font-size:8px;fill:#fff;font-family:ArialMT, Arial">80064</text><text transform="translate(1100 300)" style="isolation:isolate;font-size:8px;fill:#e74c3c;font-family:ArialMT, Arial">❌ <tspan x="8.22" y="0" style="letter-spacing:-0.01806640625em">W</tspan><tspan x="15.63" y="0">rong!</tspan></text><rect x="940.45" y="308.36" width="30" height="15" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(946.55 318.36)" style="isolation:isolate;font-size:8px;fill:#fff;font-family:ArialMT, Arial">2500</text><polygon points="988.98 326.64 970.45 316.36 991.34 312.84 988.98 326.64" style="fill:#e74c3c"/><text transform="translate(985 340)" style="isolation:isolate;font-size:8px;fill:#e74c3c;font-family:ArialMT, Arial">Another jump!</text><text transform="translate(620 341.99)" style="isolation:isolate;font-size:12px;fill:#e74c3c;font-family:ArialMT, Arial">📉 Prefetcher confidence: ~30%</text><path d="M1070,305c0,20.31-7.47,25.11-28.4,22.81-4-.44-27.83-3.32-51.6-7.81" style="fill:none;stroke:#e74c3c"/><rect x="610" y="360" width="530" height="60" style="fill:#fffefe;stroke:#bdc3c7"/><text transform="translate(620 380)" style="isolation:isolate;font-size:14px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Step 4: The Stall</text><text transform="translate(620 400)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">CPU asks for next data - cache miss! Pipeline stalls...</text><text transform="translate(620 415)" style="isolation:isolate;font-size:12px;fill:#e74c3c;font-family:ArialMT, Arial">⏳ Cold miss: ~300 cycles wait time</text><rect x="950" y="370" width="60" height="20" style="fill:#95a5a6;stroke:#7f8c8d"/><text transform="translate(962.78 383)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">EMPT<tspan x="27.78" y="0" style="letter-spacing:-0.01806640625em">Y</tspan></text><path d="M920,380h30" style="stroke:#95a5a6;stroke-width:2px;stroke-dasharray:5,5"/><text transform="translate(860 375)" style="isolation:isolate;font-size:10px;fill:#95a5a6;font-family:ArialMT, Arial">Cache Miss</text><rect x="610" y="430" width="530" height="60" style="fill:#ffebee;stroke:#e74c3c;stroke-width:2px"/><text transform="translate(620 450)" style="isolation:isolate;font-size:14px;fill:#e74c3c;font-family:Arial-BoldMT, Arial;font-weight:700">Step 5: Stalled Pipeline</text><text transform="translate(620 470)" style="isolation:isolate;font-size:12px;fill:#34495e;font-family:ArialMT, Arial">Compute units idle 60% of the time waiting for data</text><text transform="translate(620.49 484.83)" style="isolation:isolate;font-size:12px;fill:#e74c3c;font-family:ArialMT, Arial">💥 Result: Memory-bound, ~40% compute utilization</text></svg>