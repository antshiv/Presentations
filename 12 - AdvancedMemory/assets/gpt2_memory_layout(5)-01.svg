<svg id="faddbac1-c7db-423a-b68d-4bd101450633" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 557.79"><text transform="translate(573.93 25)" style="isolation:isolate;font-size:18px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Memory Layout Comparison: Block-per-<tspan x="343.05" y="0" style="letter-spacing:-0.07421875em">T</tspan><tspan x="352.71" y="0">ensor vs Layer-by-Layer</tspan><tspan x="560.8" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="565.14" y="0">Allocation</tspan></text><rect x="50" y="50" width="850" height="480" rx="6" style="fill:#e8f4fd;stroke:#3498db;stroke-width:2px"/><text transform="translate(303.29 80)" style="isolation:isolate;font-size:16px;fill:#2980b9;font-family:Arial-BoldMT, Arial;font-weight:700">CURREN<tspan x="68.45" y="0" style="letter-spacing:-0.11083984375em">T</tspan><tspan x="76.45" y="0">: Block-per-</tspan><tspan x="165.34" y="0" style="letter-spacing:-0.07421875em">T</tspan><tspan x="173.93" y="0">ensor (Karapathy</tspan><tspan x="305.52" y="0" style="letter-spacing:-0.037109375em">’</tspan><tspan x="309.38" y="0">s Structure)</tspan></text><text transform="translate(70 105)" style="isolation:isolate;font-size:12px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Parameters:</text><rect x="90" y="115" width="760" height="30" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(243.24 135)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">qkvw: [L0_qkv|L1_qkv|L2_qkv|...|L<tspan x="152.14" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="156.96" y="0">1_qkv] -</tspan><tspan x="192.53" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="194.76" y="0">All layers in one block</tspan></text><rect x="90" y="155" width="760" height="30" style="fill:#2ecc71;stroke:#27ae60"/><text transform="translate(262.74 175)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">fcw: [L0_fc|L1_fc|L2_fc|...|L<tspan x="121.01" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="125.83" y="0">1_fc] -</tspan><tspan x="153.62" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="155.84" y="0">All layers in one block</tspan></text><rect x="90" y="195" width="760" height="30" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(241.84 215)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">ln1w: [L0_ln1|L1_ln1|L2_ln1|...|L<tspan x="143.28" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="148.1" y="0">1_ln1] -</tspan><tspan x="181.45" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="183.68" y="0">All layers in one block</tspan></text><text transform="translate(70 245)" style="isolation:isolate;font-size:12px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Activations:</text><rect x="90" y="255" width="760" height="30" style="fill:#f39c12;stroke:#e67e22"/><text transform="translate(266.01 275)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">qkv: [L0_qkv_acts|L1_qkv_acts|L2_qkv_acts|...|L<tspan x="216.63" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="221.45" y="0">1_qkv_acts]</tspan></text><rect x="90" y="295" width="760" height="30" style="fill:#9b59b6;stroke:#8e44ad"/><text transform="translate(279.96 315)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">fch: [L0_fch_acts|L1_fch_acts|L2_fch_acts|...|L<tspan x="207.74" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="212.56" y="0">1_fch_acts]</tspan></text><rect x="90" y="335" width="760" height="30" style="fill:#1abc9c;stroke:#16a085"/><text transform="translate(264.61 355)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">ln1: [L0_ln1_acts|L1_ln1_acts|L2_ln1_acts|...|L<tspan x="207.76" y="0" style="letter-spacing:-0.07421875em">1</tspan><tspan x="212.58" y="0">1_ln1_acts]</tspan></text><rect x="90" y="380" width="760" height="60" style="fill:#ecf0f1;stroke:#bdc3c7"/><text transform="translate(384.7 400)" style="isolation:isolate;font-size:11px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Access Pattern: Process Layer 5</text><text transform="translate(100 420)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:CourierNewPSMT, Courier New">layer5_qkv_weights = params.qkvw + 5 * 3 * C * C; // Jump across blocks</text><text transform="translate(100 435)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:CourierNewPSMT, Courier New">layer5_fc_weights = params.fcw + 5 * 4 * C * C; // Jump across blocks</text><rect x="90" y="450" width="370" height="70" style="fill:#d5f4e6;stroke:#27ae60"/><text transform="translate(259.41 470)" style="isolation:isolate;font-size:11px;fill:#27ae60;font-family:Arial-BoldMT, Arial;font-weight:700">PROS</text><text transform="translate(100 485)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Simple pointer arithmetic per tensor</text><text transform="translate(100 500)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Easy memory management (16 allocations)</text><text transform="translate(100 515)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Good for tensor-parallel operations</text><rect x="480" y="450" width="370" height="70" style="fill:#ffeaa7;stroke:#fdcb6e"/><text transform="translate(649.11 470)" style="isolation:isolate;font-size:11px;fill:#e17055;font-family:Arial-BoldMT, Arial;font-weight:700">CONS</text><text transform="translate(490 485)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Poor cache locality for layer processing</text><text transform="translate(490 500)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Memory scattered across tensor types</text><text transform="translate(490 515)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Many pointer jumps during forward pass</text><rect x="950" y="50" width="800" height="480" rx="6" style="fill:#fff3cd;stroke:#f39c12;stroke-width:2px"/><text transform="translate(1192.35 80)" style="isolation:isolate;font-size:16px;fill:#e67e22;font-family:Arial-BoldMT, Arial;font-weight:700">A<tspan x="11.55" y="0" style="letter-spacing:-0.07421875em">L</tspan><tspan x="20.14" y="0">TERN</tspan><tspan x="63.7" y="0" style="letter-spacing:-0.07421875em">A</tspan><tspan x="74.06" y="0">TIVE: Layer-by-Layer</tspan><tspan x="234.12" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="237.97" y="0">Allocation</tspan></text><text transform="translate(970 105)" style="isolation:isolate;font-size:12px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Layer 0:</text><rect x="990" y="115" width="180" height="25" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(1056.62 132)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L0_qkvw</text><rect x="1180" y="115" width="140" height="25" style="fill:#2ecc71;stroke:#27ae60"/><text transform="translate(1230.13 132)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L0_fcw</text><rect x="1330" y="115" width="100" height="25" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(1356.37 132)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L0_ln1w</text><rect x="1440" y="115" width="280" height="25" style="fill:#9b59b6;stroke:#8e44ad"/><text transform="translate(1542.84 132)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L0_activations</text><text transform="translate(970 155)" style="isolation:isolate;font-size:12px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Layer 1:</text><rect x="990" y="165" width="180" height="25" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(1056.62 182)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L1_qkvw</text><rect x="1180" y="165" width="140" height="25" style="fill:#2ecc71;stroke:#27ae60"/><text transform="translate(1230.13 182)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L1_fcw</text><rect x="1330" y="165" width="100" height="25" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(1356.37 182)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L1_ln1w</text><rect x="1440" y="165" width="280" height="25" style="fill:#9b59b6;stroke:#8e44ad"/><text transform="translate(1542.84 182)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L1_activations</text><text transform="translate(970 205)" style="isolation:isolate;font-size:12px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Layer 2:</text><rect x="990" y="215" width="180" height="25" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(1056.62 232)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L2_qkvw</text><rect x="1180" y="215" width="140" height="25" style="fill:#2ecc71;stroke:#27ae60"/><text transform="translate(1230.13 232)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L2_fcw</text><rect x="1330" y="215" width="100" height="25" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(1356.37 232)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L2_ln1w</text><rect x="1440" y="215" width="280" height="25" style="fill:#9b59b6;stroke:#8e44ad"/><text transform="translate(1542.84 232)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L2_activations</text><text transform="translate(1323.12 265)" style="isolation:isolate;font-size:14px;fill:#7f8c8d;font-family:MyriadPro-Regular, Myriad Pro">...</text><text transform="translate(970 295)" style="isolation:isolate;font-size:12px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Layer <tspan x="35.36" y="0" style="letter-spacing:-0.05517578125em">1</tspan><tspan x="41.37" y="0">1:</tspan></text><rect x="990" y="305" width="180" height="25" style="fill:#3498db;stroke:#2980b9"/><text transform="translate(1050.86 322)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L<tspan x="4.1" y="0" style="letter-spacing:-0.06005859375em">1</tspan><tspan x="7.67" y="0">1_qkvw</tspan></text><rect x="1180" y="305" width="140" height="25" style="fill:#2ecc71;stroke:#27ae60"/><text transform="translate(1224.37 322)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L<tspan x="4.1" y="0" style="letter-spacing:-0.06005859375em">1</tspan><tspan x="7.67" y="0">1_fcw</tspan></text><rect x="1330" y="305" width="100" height="25" style="fill:#e74c3c;stroke:#c0392b"/><text transform="translate(1350.61 322)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L<tspan x="4.1" y="0" style="letter-spacing:-0.06005859375em">1</tspan><tspan x="7.67" y="0">1_ln1w</tspan></text><rect x="1440" y="305" width="280" height="25" style="fill:#9b59b6;stroke:#8e44ad"/><text transform="translate(1537.08 322)" style="isolation:isolate;font-size:9px;fill:#fff;font-family:ArialNarrow, Arial">L<tspan x="4.1" y="0" style="letter-spacing:-0.06005859375em">1</tspan><tspan x="7.67" y="0">1_activations</tspan></text><rect x="990" y="350" width="730" height="60" style="fill:#ecf0f1;stroke:#bdc3c7"/><text transform="translate(1269.7 370)" style="isolation:isolate;font-size:11px;fill:#2c3e50;font-family:Arial-BoldMT, Arial;font-weight:700">Access Pattern: Process Layer 5</text><text transform="translate(1000 390)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:CourierNewPSMT, Courier New">layer5_base = layer_memory + 5 * layer_size; // Single pointer jump</text><text transform="translate(1000 405)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:CourierNewPSMT, Courier New">// All layer 5 data is now contiguous: qkv, fc, ln1, activations</text><rect x="990" y="420" width="350" height="100" style="fill:#d5f4e6;stroke:#27ae60"/><text transform="translate(1149.41 440)" style="isolation:isolate;font-size:11px;fill:#27ae60;font-family:Arial-BoldMT, Arial;font-weight:700">PROS</text><text transform="translate(1000 455)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Excellent cache locality per layer</text><text transform="translate(1000 470)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">•<tspan x="3.15" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="5.15" y="0">All layer data together</tspan></text><text transform="translate(1000 485)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Perfect for layer parallelism</text><text transform="translate(1000 500)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Minimal pointer arithmetic</text><text transform="translate(1000 515)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Easy gradient checkpointing</text><rect x="1360" y="420" width="360" height="100" style="fill:#ffeaa7;stroke:#fdcb6e"/><text transform="translate(1524.11 440)" style="isolation:isolate;font-size:11px;fill:#e17055;font-family:Arial-BoldMT, Arial;font-weight:700">CONS</text><text transform="translate(1370 455)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Complex pointer management</text><text transform="translate(1370 470)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• More complex tensor operations</text><text transform="translate(1370 485)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Harder to vectorize across layers</text><text transform="translate(1370 500)" style="isolation:isolate;font-size:9px;fill:#2c3e50;font-family:ArialMT, Arial">• Memory fragmentation risk</text></svg>