<svg width="960" height="540" viewBox="0 0 960 540" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="gradThread" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#60a5fa"/>
      <stop offset="100%" stop-color="#22d3ee"/>
    </linearGradient>
    <linearGradient id="gradFeature" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#34d399"/>
      <stop offset="100%" stop-color="#4ade80"/>
    </linearGradient>
    <linearGradient id="gradGlobal" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#f472b6"/>
      <stop offset="100%" stop-color="#f97316"/>
    </linearGradient>
    <style>
      .label { font-family: "JetBrains Mono", "Fira Code", monospace; font-size: 18px; fill: #e2e8f0;}
      .title { font-family: "Inter", "Segoe UI", sans-serif; font-size: 24px; fill: #f8fafc; font-weight: 600;}
      .arrow { stroke: #94a3b8; stroke-width: 3; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="5" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#94a3b8"/>
    </marker>
  </defs>
  <rect width="960" height="540" fill="#0f172a" rx="20"/>
  <text x="480" y="50" text-anchor="middle" class="title">Feature-Parallel Gradient Accumulation (per FC row)</text>
  <!-- Thread column -->
  <rect x="80" y="100" width="200" height="320" fill="#1e293b" rx="18"/>
  <text x="180" y="130" text-anchor="middle" class="label" fill="#fbbf24">Threads</text>
  <rect x="110" y="150" width="140" height="60" fill="url(#gradThread)" rx="12"/>
  <text x="180" y="185" text-anchor="middle" class="label">Thread 0</text>
  <rect x="110" y="230" width="140" height="60" fill="url(#gradThread)" rx="12"/>
  <text x="180" y="265" text-anchor="middle" class="label">Thread 1</text>
  <rect x="110" y="310" width="140" height="60" fill="url(#gradThread)" rx="12"/>
  <text x="180" y="345" text-anchor="middle" class="label">Thread 2</text>
  <text x="180" y="395" text-anchor="middle" class="label" fill="#818cf8">…</text>
  <!-- Feature tiles -->
  <rect x="360" y="140" width="220" height="260" fill="#1d1f33" rx="18"/>
  <text x="470" y="170" text-anchor="middle" class="label" fill="#fbbf24">Cache-line sized feature tiles</text>
  <rect x="380" y="190" width="180" height="50" fill="url(#gradFeature)" rx="10"/>
  <text x="470" y="220" text-anchor="middle" class="label">Features 0–63</text>
  <rect x="380" y="250" width="180" height="50" fill="url(#gradFeature)" rx="10"/>
  <text x="470" y="280" text-anchor="middle" class="label">Features 64–127</text>
  <rect x="380" y="310" width="180" height="50" fill="url(#gradFeature)" rx="10"/>
  <text x="470" y="340" text-anchor="middle" class="label">Features 128–191</text>
  <text x="470" y="380" text-anchor="middle" class="label" fill="#a5b4fc">…</text>
  <!-- Thread arrows -->
  <line x1="250" y1="180" x2="360" y2="215" class="arrow"/>
  <line x1="250" y1="260" x2="360" y2="275" class="arrow"/>
  <line x1="250" y1="340" x2="360" y2="335" class="arrow"/>
  <!-- Local accumulators -->
  <rect x="640" y="150" width="240" height="240" fill="#1e2f3b" rx="18"/>
  <text x="760" y="180" text-anchor="middle" class="label" fill="#fbbf24">Thread-local accumulators</text>
  <rect x="665" y="200" width="190" height="60" fill="url(#gradGlobal)" rx="12"/>
  <text x="760" y="235" text-anchor="middle" class="label">Row Grad (Thread 0)</text>
  <rect x="665" y="275" width="190" height="60" fill="url(#gradGlobal)" rx="12"/>
  <text x="760" y="310" text-anchor="middle" class="label">Row Grad (Thread 1)</text>
  <rect x="665" y="350" width="190" height="60" fill="url(#gradGlobal)" rx="12"/>
  <text x="760" y="385" text-anchor="middle" class="label">Row Grad (Thread 2)</text>
  <!-- Accumulator arrows -->
  <line x1="560" y1="215" x2="640" y2="230" class="arrow"/>
  <line x1="560" y1="275" x2="640" y2="295" class="arrow"/>
  <line x1="560" y1="335" x2="640" y2="360" class="arrow"/>
  <!-- Global reduction -->
  <rect x="640" y="420" width="240" height="80" fill="#2b0b32" rx="18"/>
  <text x="760" y="455" text-anchor="middle" class="label" fill="#f472b6">Global weight gradient</text>
  <line x1="760" y1="370" x2="760" y2="420" class="arrow"/>
  <text x="480" y="480" text-anchor="middle" class="label" fill="#94a3b8">
    No atomics • Each thread owns a unique cache-line chunk • Final reduction happens once per row
  </text>
</svg>
