<svg id="fafc8de3-097a-4752-8e38-21614c95095f" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1200 800"><defs><linearGradient id="bf17c50c-b5cf-4ed3-8818-14622f248e56" x1="-357.2" y1="938.18" x2="-356.2" y2="938.18" gradientTransform="matrix(200, 0, 0, -60, 71561, 56641)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff6b6b"/><stop offset="1" stop-color="#ee5a24"/></linearGradient><linearGradient id="ba9873bd-967c-49a3-9a0c-8e3862ad9c71" x1="-357.2" y1="938.18" x2="-356.2" y2="938.18" gradientTransform="matrix(200, 0, 0, -60, 71561, 56721)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#3498db"/><stop offset="1" stop-color="#2980b9"/></linearGradient><linearGradient id="f3ed35f9-1879-4257-a633-f0840e38a63c" x1="-357.2" y1="938.18" x2="-356.2" y2="938.18" gradientTransform="matrix(200, 0, 0, -60, 71561, 56801)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#9b59b6"/><stop offset="1" stop-color="#8e44ad"/></linearGradient><linearGradient id="a3c618c2-30d3-4aa6-a9f9-78b969f4f1fc" x1="-357.2" y1="938.18" x2="-356.2" y2="938.18" gradientTransform="matrix(200, 0, 0, -60, 72161, 56641)" xlink:href="#bf17c50c-b5cf-4ed3-8818-14622f248e56"/><linearGradient id="b464eda9-18a8-4498-848f-458091b90506" x1="-357.2" y1="938.18" x2="-356.2" y2="938.18" gradientTransform="matrix(200, 0, 0, -60, 72161, 56721)" xlink:href="#ba9873bd-967c-49a3-9a0c-8e3862ad9c71"/><linearGradient id="f6f95e89-8945-4e10-9e3c-d5d71f20f6a4" x1="-357.2" y1="937.85" x2="-356.2" y2="937.85" gradientTransform="matrix(200, 0, 0, -60, 72161, 56801)" xlink:href="#f3ed35f9-1879-4257-a633-f0840e38a63c"/></defs><text transform="translate(238.56 30)" style="isolation:isolate;font-size:24px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">Cache Performance: Sequential vs Fragmented Memory Layout</text><text transform="translate(123.67 70)" style="isolation:isolate;font-size:18px;fill:#2ecc71;font-family:Arial-BoldMT, Arial;font-weight:700">Sequential Layout (Karpathy&apos;s<tspan x="258.33" y="0" style="letter-spacing:-0.037109375em"> </tspan><tspan x="262.66" y="0">Approach)</tspan></text><text transform="translate(739.47 70)" style="isolation:isolate;font-size:18px;fill:#e74c3c;font-family:Arial-BoldMT, Arial;font-weight:700">Fragmented Layout (Separate Malloc)</text><text transform="translate(50 110)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">Memory<tspan x="43.34" y="0" style="letter-spacing:-0.05517578125em"> </tspan><tspan x="46.01" y="0">Addresses</tspan></text><line x1="100" y1="120" x2="100" y2="700" style="fill:none;stroke:#fff;stroke-width:2px"/><text transform="translate(58.61 130)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x1000</text><text transform="translate(58.61 200)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x2000</text><text transform="translate(58.61 270)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x3000</text><text transform="translate(58.61 340)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x4000</text><text transform="translate(58.61 410)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x5000</text><text transform="translate(58.61 480)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x6000</text><text transform="translate(58.61 550)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x7000</text><text transform="translate(58.61 620)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x8000</text><text transform="translate(58.61 690)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">0x9000</text><rect x="120" y="130" width="150" height="25" style="fill:#e74c3c;stroke:#fff"/><text transform="translate(144 147)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">wte (embeddings)</text><rect x="120" y="155" width="150" height="25" style="fill:#f39c12;stroke:#fff"/><text transform="translate(151 172)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">wpe (positions)</text><rect x="120" y="180" width="150" height="25" style="fill:#3498db;stroke:#fff"/><text transform="translate(149 197)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">qkvw (attention)</text><rect x="120" y="205" width="150" height="25" style="fill:#9b59b6;stroke:#fff"/><text transform="translate(146.99 222)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">ln1w (layernorm)</text><rect x="120" y="230" width="150" height="25" style="fill:#27ae60;stroke:#fff"/><text transform="translate(145 247)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">fcw (feedforward)</text><rect x="720" y="140" width="150" height="20" style="fill:#e74c3c;stroke:#fff"/><text transform="translate(786.44 153)" style="isolation:isolate;font-size:11px;fill:#fff;font-family:ArialMT, Arial">wte</text><rect x="720" y="190" width="150" height="20" style="fill:#f39c12;stroke:#fff"/><text transform="translate(784.91 203)" style="isolation:isolate;font-size:11px;fill:#fff;font-family:ArialMT, Arial">wpe</text><rect x="720" y="300" width="150" height="20" style="fill:#3498db;stroke:#fff"/><text transform="translate(782.47 313)" style="isolation:isolate;font-size:11px;fill:#fff;font-family:ArialMT, Arial">qkvw</text><rect x="720" y="470" width="150" height="20" style="fill:#9b59b6;stroke:#fff"/><text transform="translate(783.69 483)" style="isolation:isolate;font-size:11px;fill:#fff;font-family:ArialMT, Arial">ln1w</text><rect x="720" y="570" width="150" height="20" style="fill:#27ae60;stroke:#fff"/><text transform="translate(786.75 583)" style="isolation:isolate;font-size:11px;fill:#fff;font-family:ArialMT, Arial">fcw</text><rect x="120" y="320" width="200" height="60" rx="5" style="stroke:#fff;stroke-width:2px;fill:url(#bf17c50c-b5cf-4ed3-8818-14622f248e56)"/><text transform="translate(164.37 340)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">L1 Cache (16KB)</text><text transform="translate(192.99 355)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">1-2 cycles</text><rect x="130" y="360" width="30" height="15" style="fill:#e74c3c;isolation:isolate;opacity:0.800000011920929"/><rect x="165" y="360" width="30" height="15" style="fill:#f39c12;isolation:isolate;opacity:0.800000011920929"/><rect x="200" y="360" width="30" height="15" style="fill:#3498db;isolation:isolate;opacity:0.800000011920929"/><rect x="235" y="360" width="30" height="15" style="fill:#9b59b6;isolation:isolate;opacity:0.800000011920929"/><text transform="translate(174.41 372)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">4 cache lines loaded</text><rect x="120" y="400" width="200" height="60" rx="5" style="stroke:#fff;stroke-width:2px;fill:url(#ba9873bd-967c-49a3-9a0c-8e3862ad9c71)"/><text transform="translate(164.37 420)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">L2 Cache (32KB)</text><text transform="translate(192.99 435)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">3-5 cycles</text><rect x="130" y="440" width="25" height="15" style="fill:#e74c3c;isolation:isolate;opacity:0.800000011920929"/><rect x="160" y="440" width="25" height="15" style="fill:#f39c12;isolation:isolate;opacity:0.800000011920929"/><rect x="190" y="440" width="25" height="15" style="fill:#3498db;isolation:isolate;opacity:0.800000011920929"/><rect x="220" y="440" width="25" height="15" style="fill:#9b59b6;isolation:isolate;opacity:0.800000011920929"/><rect x="250" y="440" width="25" height="15" style="fill:#27ae60;isolation:isolate;opacity:0.800000011920929"/><text transform="translate(174.41 452)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">8 cache lines loaded</text><rect x="120" y="480" width="200" height="60" rx="5" style="stroke:#fff;stroke-width:2px;fill:url(#f3ed35f9-1879-4257-a633-f0840e38a63c)"/><text transform="translate(164.37 500)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">L3 Cache (64KB)</text><text transform="translate(186.32 515)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">10-20 cycles</text><rect x="125" y="520" width="20" height="15" style="fill:#e74c3c;isolation:isolate;opacity:0.800000011920929"/><rect x="150" y="520" width="20" height="15" style="fill:#f39c12;isolation:isolate;opacity:0.800000011920929"/><rect x="175" y="520" width="20" height="15" style="fill:#3498db;isolation:isolate;opacity:0.800000011920929"/><rect x="200" y="520" width="20" height="15" style="fill:#9b59b6;isolation:isolate;opacity:0.800000011920929"/><rect x="225" y="520" width="20" height="15" style="fill:#27ae60;isolation:isolate;opacity:0.800000011920929"/><rect x="250" y="520" width="20" height="15" style="fill:#6c5ce7;isolation:isolate;opacity:0.800000011920929"/><rect x="275" y="520" width="20" height="15" style="fill:#a29bfe;isolation:isolate;opacity:0.800000011920929"/><rect x="300" y="520" width="15" height="15" style="fill:#fd79a8;isolation:isolate;opacity:0.800000011920929"/><text transform="translate(171.63 532)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">16 cache lines loaded</text><rect x="720" y="320" width="200" height="60" rx="5" style="stroke:#fff;stroke-width:2px;fill:url(#a3c618c2-30d3-4aa6-a9f9-78b969f4f1fc)"/><text transform="translate(764.37 340)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">L1 Cache (16KB)</text><text transform="translate(792.99 355)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">1-2 cycles</text><rect x="730" y="360" width="30" height="15" style="fill:#e74c3c;isolation:isolate;opacity:0.800000011920929"/><rect x="765" y="360" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="785" y="360" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="805" y="360" width="30" height="15" style="fill:#f39c12;isolation:isolate;opacity:0.800000011920929"/><text transform="translate(778.17 372)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">Partial data + gaps</text><rect x="720" y="400" width="200" height="60" rx="5" style="stroke:#fff;stroke-width:2px;fill:url(#b464eda9-18a8-4498-848f-458091b90506)"/><text transform="translate(764.37 420)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">L2 Cache (32KB)</text><text transform="translate(792.99 435)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">3-5 cycles</text><rect x="730" y="440" width="25" height="15" style="fill:#e74c3c;isolation:isolate;opacity:0.800000011920929"/><rect x="760" y="440" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="780" y="440" width="25" height="15" style="fill:#f39c12;isolation:isolate;opacity:0.800000011920929"/><rect x="810" y="440" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="830" y="440" width="25" height="15" style="fill:#3498db;isolation:isolate;opacity:0.800000011920929"/><text transform="translate(787.48 452)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">Scattered data</text><rect x="720" y="500" width="200" height="60" rx="5" style="stroke:#fff;stroke-width:2px;fill:url(#f6f95e89-8945-4e10-9e3c-d5d71f20f6a4)"/><text transform="translate(764.37 520)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:Arial-BoldMT, Arial;font-weight:700">L3 Cache (64KB)</text><text transform="translate(786.32 535)" style="isolation:isolate;font-size:12px;fill:#fff;font-family:ArialMT, Arial">10-20 cycles</text><rect x="725" y="540" width="20" height="15" style="fill:#e74c3c;isolation:isolate;opacity:0.800000011920929"/><rect x="750" y="540" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="770" y="540" width="20" height="15" style="fill:#f39c12;isolation:isolate;opacity:0.800000011920929"/><rect x="795" y="540" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="815" y="540" width="20" height="15" style="fill:#3498db;isolation:isolate;opacity:0.800000011920929"/><rect x="840" y="540" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="860" y="540" width="20" height="15" style="fill:#9b59b6;isolation:isolate;opacity:0.800000011920929"/><rect x="885" y="540" width="15" height="15" style="fill:#34495e;isolation:isolate;opacity:0.5"/><rect x="905" y="540" width="10" height="15" style="fill:#27ae60;isolation:isolate;opacity:0.800000011920929"/><text transform="translate(773.77 552)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.037109375em">W</tspan><tspan x="9.07" y="0">asted cache space</tspan></text><polygon points="293.63 280.84 262.5 287.27 282.82 262.83 293.63 280.84" style="fill:#2ecc71"/><text transform="translate(150 295)" style="isolation:isolate;font-size:12px;fill:#2ecc71;font-family:Arial-BoldMT, Arial;font-weight:700">Prefetch works!</text><text transform="translate(140 308)" style="isolation:isolate;font-size:10px;fill:#2ecc71;font-family:ArialMT, Arial">Related data loaded together</text><polygon points="872.64 273.45 841.52 279.89 861.84 255.45 872.64 273.45" style="fill:#e74c3c"/><text transform="translate(750 280.4)" style="isolation:isolate;font-size:12px;fill:#e74c3c;font-family:Arial-BoldMT, Arial;font-weight:700">Prefetch fails!</text><text transform="translate(740 293.4)" style="isolation:isolate;font-size:10px;fill:#e74c3c;font-family:ArialMT, Arial">Unrelated data loaded</text><rect x="120" y="600" width="200" height="80" rx="10" style="stroke:#2ecc71;stroke-width:2px"/><text transform="translate(128.41 620)" style="isolation:isolate;font-size:16px;fill:#2ecc71;font-family:Arial-BoldMT, Arial;font-weight:700">Sequential Performance</text><text transform="translate(154.63 640)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial">Cache Hit Rate: 85%</text><text transform="translate(164.76 655)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial">DRAM Fetches: 2</text><text transform="translate(166.7 670)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.11083984375em">T</tspan><tspan x="7" y="0">otal Cycles: 150</tspan></text><rect x="720" y="600" width="200" height="80" rx="10" style="stroke:#e74c3c;stroke-width:2px"/><text transform="translate(723.08 620)" style="isolation:isolate;font-size:16px;fill:#e74c3c;font-family:Arial-BoldMT, Arial;font-weight:700">Fragmented Performance</text><text transform="translate(754.63 640)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial">Cache Hit Rate: 35%</text><text transform="translate(764.76 655)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial">DRAM Fetches: 8</text><text transform="translate(766.7 670)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial"><tspan style="letter-spacing:-0.11083984375em">T</tspan><tspan x="7" y="0">otal Cycles: 950</tspan></text><text transform="translate(556.88 720)" style="isolation:isolate;font-size:16px;fill:#f39c12;font-family:Arial-BoldMT, Arial;font-weight:700">Key Insight</text><text transform="translate(396.22 740)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial">Sequential layout enables e<tspan x="172.02" y="0" style="letter-spacing:-0.01806640625em">f</tspan><tspan x="175.66" y="0">fective prefetching and spatial locality</tspan></text><text transform="translate(382.1 755)" style="isolation:isolate;font-size:14px;fill:#fff;font-family:ArialMT, Arial">Fragmented layout wastes cache space and causes frequent evictions</text><text transform="translate(386.73 775)" style="isolation:isolate;font-size:14px;fill:#2ecc71;font-family:Arial-BoldMT, Arial;font-weight:700">Result: 6x performance improvement with Karpathy&apos;s approach!</text><text transform="translate(340 340)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">64-byte</text><text transform="translate(340 352)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">cache lines</text><text transform="translate(940 340)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">Same 64-byte</text><text transform="translate(940 352)" style="isolation:isolate;font-size:10px;fill:#fff;font-family:ArialMT, Arial">cache lines</text><circle cx="350" cy="200" r="8" style="fill:#2ecc71;isolation:isolate;opacity:0.699999988079071"/><text transform="translate(365 205)" style="isolation:isolate;font-size:12px;fill:#2ecc71;font-family:ArialMT, Arial">1 access loads all</text><circle cx="950" cy="250" r="8" style="fill:#e74c3c;isolation:isolate;opacity:0.699999988079071"/><circle cx="948.86" cy="380" r="8" style="fill:#e74c3c;isolation:isolate;opacity:0.699999988079071"/><circle cx="950" cy="500" r="8" style="fill:#e74c3c;isolation:isolate;opacity:0.699999988079071"/><text transform="translate(959.14 384.22)" style="isolation:isolate;font-size:12px;fill:#e74c3c;font-family:ArialMT, Arial">Multiple accesses</text></svg>